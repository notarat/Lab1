#include <iostream>
#include <string>
#include <vector>
#include <fstream>

// Структура для представления трубы
struct Труба {
    std::string название;
    double длина;
    double диаметр;
    bool вРемонте;

    // Ввод данных о трубе
    void ввод() {
        std::cout << "Введите название трубы: ";
        std::cin.ignore();
        std::getline(std::cin, название);
        std::cout << "Введите длину трубы: ";
        std::cin >> длина;
        std::cout << "Введите диаметр трубы: ";
        std::cin >> диаметр;
        std::cout << "Находится ли труба в ремонте? (1 - да, 0 - нет): ";
        std::cin >> вРемонте;
    }

    // Вывод данных о трубе
    void вывод() const {
        std::cout << "Название трубы: " << название << std::endl;
        std::cout << "Длина: " << длина << " км" << std::endl;
        std::cout << "Диаметр: " << диаметр << " м" << std::endl;
        std::cout << "В ремонте: " << (вРемонте ? "Да" : "Нет") << std::endl;
    }

    // Редактирование признака "в ремонте"
    void изменитьСтатусРемонта() {
        std::cout << "Введите новый статус ремонта (1 - да, 0 - нет): ";
        std::cin >> вРемонте;
    }
};

// Структура для представления компрессорной станции (КС)
struct КомпрессорнаяСтанция {
    std::string название;
    int общееКолВоЦехов;
    int активныеЦеха;
    double эффективность;

    // Ввод данных о КС
    void ввод() {
        std::cout << "Введите название станции: ";
        std::cin.ignore();
        std::getline(std::cin, название);
        std::cout << "Введите общее количество цехов: ";
        std::cin >> общееКолВоЦехов;
        std::cout << "Введите количество активных цехов: ";
        std::cin >> активныеЦеха;
        while (активныеЦеха > общееКолВоЦехов || активныеЦеха < 0) {
            std::cout << "Неверное значение. Активные цеха не могут превышать общее количество или быть меньше 0." << std::endl;
            std::cout << "Введите количество активных цехов: ";
            std::cin >> активныеЦеха;
        }
        std::cout << "Введите эффективность станции: ";
        std::cin >> эффективность;
    }

    // Вывод данных о КС
    void вывод() const {
        std::cout << "Название станции: " << название << std::endl;
        std::cout << "Общее количество цехов: " << общееКолВоЦехов << std::endl;
        std::cout << "Активные цеха: " << активныеЦеха << std::endl;
        std::cout << "Эффективность: " << эффективность << std::endl;
    }

    // Запуск цеха
    void запуститьЦех() {
        if (активныеЦеха < общееКолВоЦехов) {
            активныеЦеха++;
            std::cout << "Цех запущен. Активные цеха: " << активныеЦеха << std::endl;
        } else {
            std::cout << "Все цеха уже активны." << std::endl;
        }
    }

    // Остановка цеха
    void остановитьЦех() {
        if (активныеЦеха > 0) {
            активныеЦеха--;
            std::cout << "Цех остановлен. Активные цеха: " << активныеЦеха << std::endl;
        } else {
            std::cout << "Нет активных цехов для остановки." << std::endl;
        }
    }
};

// Функции для сохранения и загрузки данных в файл
void сохранитьВФайл(const std::vector<Труба>& трубы, const std::vector<КомпрессорнаяСтанция>& станции) {
    std::ofstream файл("данные.txt");
    if (!файл.is_open()) {
        std::cerr << "Ошибка открытия файла для сохранения!" << std::endl;
        return;
    }

    файл << трубы.size() << std::endl;
    for (const auto& труба : трубы) {
        файл << труба.название
             << std::endl << труба.длина
             << std::endl << труба.диаметр
             << std::endl << труба.вРемонте << std::endl;
    }

    файл << станции.size() << std::endl;
    for (const auto& станция : станции) {
        файл << станция.название
             << std::endl << станция.общееКолВоЦехов
             << std::endl << станция.активныеЦеха
             << std::endl << станция.эффективность << std::endl;
    }

    файл.close();
    std::cout << "Данные успешно сохранены." << std::endl;
}

void загрузитьИзФайла(std::vector<Труба>& трубы, std::vector<КомпрессорнаяСтанция>& станции) {
    std::ifstream файл("данные.txt");
    if (!файл.is_open()) {
        std::cerr << "Ошибка открытия файла для загрузки!" << std::endl;
        return;
    }

    size_t количествоТруб, количествоСтанций;
    файл >> количествоТруб;
    трубы.clear();
    трубы.resize(количествоТруб);
    файл.ignore();
    for (auto& труба : трубы) {
        std::getline(файл, труба.название);
        файл >> труба.длина >> труба.диаметр >> труба.вРемонте;
        файл.ignore();
    }

    файл >> количествоСтанций;
    станции.clear();
    станции.resize(количествоСтанций);
    файл.ignore();
    for (auto& станция : станции) {
        std::getline(файл, станция.название);
        файл >> станция.общееКолВоЦехов >> станция.активныеЦеха >> станция.эффективность;
        файл.ignore();
    }

    файл.close();
    std::cout << "Данные успешно загружены." << std::endl;
}

int main() {
    std::vector<Труба> трубы;
    std::vector<КомпрессорнаяСтанция> станции;
    int выбор;

    while (true) {
        std::cout << "1. Добавить трубу" << std::endl;
        std::cout << "2. Добавить компрессорную станцию" << std::endl;
        std::cout << "3. Просмотреть все объекты" << std::endl;
        std::cout << "4. Изменить статус ремонта трубы" << std::endl;
        std::cout << "5. Запустить/остановить цех" << std::endl;
        std::cout << "6. Сохранить" << std::endl;
        std::cout << "7. Загрузить" << std::endl;
        std::cout << "0. Выход" << std::endl;
        std::cout << "Выберите действие: ";
        std::cin >> выбор;

        if (выбор == 0) {
            break;
        }

        switch (выбор) {
            case 1: {
                Труба труба;
                труба.ввод();
                трубы.push_back(труба);
                break;
            }
            case 2: {
                КомпрессорнаяСтанция станция;
                станция.ввод();
                станции.push_back(станция);
                break;
            }
            case 3: {
                std::cout << "Трубы:" << std::endl;
                for (const auto& труба : трубы) {
                    труба.вывод();
                    std::cout << "----------------------" << std::endl;
                }
                std::cout << "Компрессорные станции:" << std::endl;
                for (const auto& станция : станции) {
                    станция.вывод();
                    std::cout << "----------------------" << std::endl;
                }
                break;
            }
            case 4: {
                std::cout << "Введите индекс трубы для редактирования: ";
                size_t индекс;
                std::cin >> индекс;
                if (индекс < трубы.size()) {
                    трубы[индекс].изменитьСтатусРемонта();
                } else {
                    std::cerr << "Неверный индекс." << std::endl;
                }
                break;
            }
            case 5: {
                std::cout << "Введите индекс компрессорной станции для редактирования: ";
                size_t индекс;
                std::cin >> индекс;
                if (индекс < станции.size()) {
                    std::cout << "1. Запустить цех" << std::endl;
                    std::cout << "2. Остановить цех" << std::endl;
                    std::cout << "Выберите действие: ";
                    int действие;
                    std::cin >> действие;
                    if (действие == 1) {
                        станции[индекс].запуститьЦех();
                    } else if (действие == 2) {
                        станции[индекс].остановитьЦех();
                    } else {
                        std::cerr << "Неверное действие." << std::endl;
                    }
                } else {
                    std::cerr << "Неверный индекс." << std::endl;
                }
                break;
            }
            case 6: {
                сохранитьВФайл(трубы, станции);
                break;
            }
            case 7: {
                загрузитьИзФайла(трубы, станции);
                break;
            }
            default:
                std::cerr << "Неверная опция. Попробуйте снова." << std::endl;
        }
    }

    return 0;
}
